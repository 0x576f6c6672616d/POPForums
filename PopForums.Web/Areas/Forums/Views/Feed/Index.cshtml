@using System.Threading.Tasks
@using PopForums.Services
@using PopForums.Web.Areas.Forums.Controllers
@using PopForums.Web.Areas.Forums.Services
@inject IUserRetrievalShim UserRetrievalShim
@inject ITimeFormattingService TimeFormattingService
@model List<PopForums.Models.FeedEvent>

@{
	ViewBag.Title = PopForums.Resources.ActivityFeed;
	Layout = "~/Areas/Forums/Views/Shared/PopForumsMaster.cshtml";
	var profile = UserRetrievalShim.GetProfile(Context);
}

@section HeaderContent {
	<script type="text/javascript" language="javascript">
		$(function () {
			PopForums.loadFeed();
		});
	</script>
}

<div>
	<h1>@PopForums.Resources.ActivityFeed</h1>
	<ul id="TopBreadcrumb" class="breadcrumb">
		<li>@Html.ActionLink(PopForums.Resources.Recent, "Recent", ForumController.Name, new { page = 1 }, null)</li>
		<li><span class="glyphicon glyphicon-chevron-up"></span> @Html.ActionLink(PopForums.Resources.Forums, "Index", HomeController.Name, null, null)</li>
	</ul>
</div>

<div id="FeedList">
@foreach (var item in Model)
{
	<div class="bg-info callout">
		<div class="feedItemText">@Html.Raw(item.Message)</div>
		<div class="text-right small fTime" data-utc="@item.TimeStamp.ToString("o")">@TimeFormattingService.GetFormattedTime(item.TimeStamp, profile)</div>
	</div>
}
	<div id="ActivityFeedTemplate" class="bg-info callout" style="display: none;">
		<div class="feedItemText"></div>
		<div class="text-right small fTime" data-utc=""></div>
	</div>
</div>